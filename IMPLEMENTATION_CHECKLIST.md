# consumePurchase å®ç°æ¸…å•

## âœ… å·²å®Œæˆçš„å®ç°

### 1. æ ¸å¿ƒæ¨¡å‹ (src/models.rs)
- [x] `ConsumePurchaseRequest` ç»“æ„ä½“
- [x] `ConsumePurchaseResponse` ç»“æ„ä½“

### 2. å‘½ä»¤å¤„ç† (src/commands.rs)
- [x] `consume_purchase` å‘½ä»¤å‡½æ•°

### 3. æ’ä»¶æ³¨å†Œ (src/lib.rs)
- [x] åœ¨ `invoke_handler` ä¸­æ³¨å†Œ `consume_purchase`

### 4. Android å®ç° (android/src/main/java/app/tauri/iap/IapPlugin.kt)
- [x] `ConsumePurchaseArgs` æ•°æ®ç±»
- [x] `consumePurchase` å‘½ä»¤å‡½æ•°
- [x] ä½¿ç”¨ `billingClient.consumeAsync()` API
- [x] é”™è¯¯å¤„ç†ï¼ˆtoken ä¸ºç©ºã€billing client æœªå°±ç»ªï¼‰
- [x] æˆåŠŸ/å¤±è´¥å“åº”

### 5. iOS å®ç° (ios/Sources/IapPlugin.swift)
- [x] `ConsumePurchaseArgs` ç±»
- [x] `consumePurchase` å‡½æ•°ï¼ˆç©ºæ“ä½œï¼‰

### 6. macOS å®ç° (macos/Sources/IapPlugin.swift)
- [x] `consumePurchase` å‡½æ•°ï¼ˆç©ºæ“ä½œï¼‰
- [x] FFI æ¡¥æ¥ (src/macos.rs)

### 7. Windows å®ç° (src/windows.rs)
- [x] `consume_purchase` å‡½æ•°ï¼ˆç©ºæ“ä½œï¼‰

### 8. Linux å®ç° (src/desktop.rs)
- [x] `consume_purchase` å‡½æ•°ï¼ˆè¿”å›ä¸æ”¯æŒé”™è¯¯ï¼‰

### 9. ç§»åŠ¨ç«¯æ¡¥æ¥ (src/mobile.rs)
- [x] `consume_purchase` å‡½æ•°è°ƒç”¨ç§»åŠ¨æ’ä»¶

### 10. TypeScript/JavaScript API (guest-js/index.ts)
- [x] `ConsumePurchaseResponse` æ¥å£
- [x] `consumePurchase` å‡½æ•°
- [x] JSDoc æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

### 11. æƒé™é…ç½®
- [x] `permissions/autogenerated/commands/consume_purchase.toml`
- [x] `permissions/default.toml` æ›´æ–°
- [x] `permissions/autogenerated/reference.md` æ›´æ–°

### 12. æµ‹è¯•
- [x] Android å•å…ƒæµ‹è¯• (android/src/androidTest/.../IapPluginInstrumentedTest.kt)

### 13. æ–‡æ¡£
- [x] `CONSUME_PURCHASE.md` - ç®€æ´ä½¿ç”¨è¯´æ˜
- [x] `examples/consumable-purchase-example.ts` - å®Œæ•´ç¤ºä¾‹

## ğŸ” Android å®ç°éªŒè¯

### Google Play Billing API ä½¿ç”¨
```kotlin
val consumeParams = ConsumeParams.newBuilder()
    .setPurchaseToken(purchaseToken)
    .build()

billingClient.consumeAsync(consumeParams) { billingResult, _ ->
    if (billingResult.responseCode == BillingClient.BillingResponseCode.OK) {
        invoke.resolve(JSObject().put("success", true))
    } else {
        invoke.reject("Failed to consume purchase: ${billingResult.debugMessage}")
    }
}
```

### é”™è¯¯å¤„ç†
- âœ… æ£€æŸ¥ `purchaseToken` æ˜¯å¦ä¸ºç©º
- âœ… æ£€æŸ¥ `billingClient.isReady`
- âœ… å¤„ç† billing å“åº”ç 
- âœ… æä¾›è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯

### å“åº”æ ¼å¼
- âœ… æˆåŠŸ: `{ "success": true }`
- âœ… å¤±è´¥: æ‹’ç»å¹¶è¿”å›é”™è¯¯æ¶ˆæ¯

## ğŸ“ ä½¿ç”¨æµç¨‹

1. ç”¨æˆ·è´­ä¹°æ¶ˆè€—å‹å•†å“
2. éªŒè¯è´­ä¹°ï¼ˆå¯é€‰ä½†æ¨èï¼‰
3. å‘æ”¾å•†å“ç»™ç”¨æˆ·
4. è°ƒç”¨ `consumePurchase(purchaseToken)`
5. ç”¨æˆ·å¯ä»¥å†æ¬¡è´­ä¹°åŒä¸€å•†å“

## ğŸ¯ å…³é”®ç‚¹

- **Android**: å¿…é¡»è°ƒç”¨ `consumePurchase`ï¼Œå¦åˆ™æ— æ³•é‡å¤è´­ä¹°
- **iOS/macOS**: è‡ªåŠ¨å¤„ç†ï¼Œè°ƒç”¨æ˜¯ç©ºæ“ä½œ
- **Windows**: è‡ªåŠ¨å¤„ç†ï¼Œè°ƒç”¨æ˜¯ç©ºæ“ä½œ
- **è·¨å¹³å°**: ç»Ÿä¸€ APIï¼Œæ— éœ€å¹³å°åˆ¤æ–­

## âœ… å®ç°å®Œæˆ

æ‰€æœ‰å¿…è¦çš„ä»£ç å·²å®ç°å¹¶é›†æˆåˆ°æ’ä»¶ä¸­ã€‚
