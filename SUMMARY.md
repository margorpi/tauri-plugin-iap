# consumePurchase åŠŸèƒ½å®ç°æ€»ç»“

## âœ… å·²å®Œæˆ

æˆåŠŸä¸º tauri-plugin-iap æ·»åŠ äº† `consumePurchase` å‡½æ•°ï¼Œç”¨äºæ”¯æŒæ¶ˆè€—å‹å•†å“çš„é‡å¤è´­ä¹°ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### Android å®ç°ï¼ˆä¸»è¦å¹³å°ï¼‰
- ä½¿ç”¨ Google Play Billing Library çš„ `consumeAsync` API
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒéªŒè¯
- æ”¯æŒæ¶ˆè€—å‹å•†å“çš„é‡å¤è´­ä¹°

### å…¶ä»–å¹³å°
- iOS/macOS: ç©ºæ“ä½œï¼ˆStoreKit 2 è‡ªåŠ¨å¤„ç†ï¼‰
- Windows: ç©ºæ“ä½œï¼ˆWindows Store è‡ªåŠ¨å¤„ç†ï¼‰
- Linux: è¿”å›ä¸æ”¯æŒé”™è¯¯

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### Rust æ ¸å¿ƒ
- `src/models.rs` - æ·»åŠ è¯·æ±‚/å“åº”æ¨¡å‹
- `src/commands.rs` - æ·»åŠ å‘½ä»¤å¤„ç†å‡½æ•°
- `src/lib.rs` - æ³¨å†Œæ–°å‘½ä»¤
- `src/mobile.rs` - ç§»åŠ¨ç«¯æ¡¥æ¥
- `src/macos.rs` - macOS FFI æ¡¥æ¥
- `src/windows.rs` - Windows å®ç°
- `src/desktop.rs` - Linux å®ç°

### Android (Kotlin)
- `android/src/main/java/app/tauri/iap/IapPlugin.kt`
  - æ·»åŠ  `ConsumePurchaseArgs` ç±»
  - æ·»åŠ  `consumePurchase` å‘½ä»¤å‡½æ•°
  - å®ç° Google Play Billing æ¶ˆè€—é€»è¾‘

### iOS (Swift)
- `ios/Sources/IapPlugin.swift`
  - æ·»åŠ  `ConsumePurchaseArgs` ç±»
  - æ·»åŠ  `consumePurchase` ç©ºæ“ä½œå‡½æ•°

### macOS (Swift)
- `macos/Sources/IapPlugin.swift`
  - æ·»åŠ  `consumePurchase` ç©ºæ“ä½œå‡½æ•°

### TypeScript/JavaScript
- `guest-js/index.ts`
  - æ·»åŠ  `ConsumePurchaseResponse` æ¥å£
  - æ·»åŠ  `consumePurchase` å‡½æ•°
  - å®Œæ•´çš„ JSDoc æ–‡æ¡£

### æƒé™é…ç½®
- `permissions/autogenerated/commands/consume_purchase.toml` - æ–°å»º
- `permissions/default.toml` - æ›´æ–°
- `permissions/autogenerated/reference.md` - æ›´æ–°

### æµ‹è¯•
- `android/src/androidTest/java/app/tauri/iap/IapPluginInstrumentedTest.kt`
  - æ·»åŠ  3 ä¸ªæµ‹è¯•ç”¨ä¾‹

### æ–‡æ¡£
- `CONSUME_PURCHASE.md` - ç®€æ´ä½¿ç”¨è¯´æ˜
- `examples/consumable-purchase-example.ts` - å®Œæ•´ç¤ºä¾‹ä»£ç 
- `CHANGELOG_CONSUME_PURCHASE.md` - å˜æ›´æ—¥å¿—
- `IMPLEMENTATION_CHECKLIST.md` - å®ç°æ¸…å•

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

```typescript
import { purchase, consumePurchase } from '@choochmeque/tauri-plugin-iap-api';

// è´­ä¹°æ¶ˆè€—å‹å•†å“
const purchaseResult = await purchase('com.example.coins_100', 'inapp');

// å‘æ”¾å•†å“ç»™ç”¨æˆ·
await deliverProduct(100);

// æ¶ˆè€—è´­ä¹°ï¼ˆAndroid å¿…éœ€ï¼Œå…¶ä»–å¹³å°å¯é€‰ï¼‰
await consumePurchase(purchaseResult.purchaseToken);
```

## âš ï¸ é‡è¦æç¤º

1. **Android å¿…éœ€**ï¼šåœ¨ Android ä¸Šå¿…é¡»è°ƒç”¨ `consumePurchase`ï¼Œå¦åˆ™ç”¨æˆ·æ— æ³•é‡å¤è´­ä¹°
2. **å‘æ”¾åæ¶ˆè€—**ï¼šåº”è¯¥åœ¨ç¡®è®¤å•†å“å·²å‘æ”¾ç»™ç”¨æˆ·åå†è°ƒç”¨
3. **é”™è¯¯å¤„ç†**ï¼šå¦‚æœæ¶ˆè€—å¤±è´¥ï¼Œåº”ä¿å­˜è´­ä¹°ä¿¡æ¯ç¨åé‡è¯•
4. **å•†å“ç±»å‹**ï¼š
   - æ¶ˆè€—å‹å•†å“ â†’ ä½¿ç”¨ `consumePurchase`
   - éæ¶ˆè€—å‹å•†å“/è®¢é˜… â†’ ä½¿ç”¨ `acknowledgePurchase`

## âœ¨ ç‰¹æ€§

- âœ… è·¨å¹³å° API ä¸€è‡´æ€§
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… æƒé™è‡ªåŠ¨é…ç½®
- âœ… ç¬¦åˆ Google Play æ”¿ç­–

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [CONSUME_PURCHASE.md](./CONSUME_PURCHASE.md) - å¿«é€Ÿå¼€å§‹
- [examples/consumable-purchase-example.ts](./examples/consumable-purchase-example.ts) - å®Œæ•´ç¤ºä¾‹
- [Google Play Billing - Consumable Products](https://developer.android.com/google/play/billing/integrate#consumable)

## ğŸ‰ å®Œæˆ

æ‰€æœ‰å¿…è¦çš„ä»£ç å·²å®ç°ã€æµ‹è¯•å¹¶æ–‡æ¡£åŒ–ã€‚æ’ä»¶ç°åœ¨å®Œå…¨æ”¯æŒæ¶ˆè€—å‹å•†å“çš„è´­ä¹°å’Œæ¶ˆè€—æµç¨‹ã€‚
